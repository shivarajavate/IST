var ist;(ist=angular.module("ist")).controller("LoginController",["$scope","$http","$window","$state","$cookies","AppService",function(e,t,o,r,n,c){e.loginFormSubmit=function(t){t?(e.error="",function(t){c.loginUser(t.name,t.password).then(function(t){200===t.status&&(e.publicToken=t.data.token),o.localStorage.setItem("publicToken",t.data.token),o.localStorage.setItem("userName",t.data.user_display_name),n.putObject("UserName",t.data.user_display_name),r.go(appConst.states.workspace)},function(t){e.error=c.getResourceText("R004")})}(t)):e.error=c.getResourceText("R004")},c.loadResources()}]),(ist=angular.module("ist")).controller("WorkspaceController",["$scope","$filter","$state","$cookies","$timeout","$interval","AppService","HeaderService","ProjectService",function(e,t,o,r,n,c,s,a,i){function u(){e.menu={show:!1,project:{show:!1,new:{show:!1},list:{show:!1},clone:{show:!1},modify:{show:!1},delete:{show:!1}},session:{show:!1},theme:{show:!1},logout:{show:!1}}}function l(){e.projectMenuError={status:!1,message:"",confirm:!1},e.deletebutton=!0}function j(t,o,r){e.projectMenuError={status:t,message:o,confirm:r},r?t&&r&&n(d,1e3):n(l,3e3)}function d(){$("#hamburgerMenu").modal("hide")}function m(){e.project&&e.project.open&&i.updateProject(e.project.model)}e.projects,e.templates,e.templateNames,e.currProject,e.currSession,e.currDuration,e.selectedProject,e.selectedSession,e.userName,e.project,e.timer,e.projectMenuError,e.menu,e.disableLinks,e.newProject,e.resetProjectMenuHeader=function(){e.selectedProject&&(e.selectedProject=e.projects[0]||{})},e.resetProjectMenu=function(){e.resetProjectMenuHeader(),l()},e.loadProjectMenu=function(){e.resetProjectMenu(),e.projects=[],e.templates=[],e.templateNames=[],i.loadProjects().then(function(o){e.projects=t("orderBy")(o,"name"),e.currProject=e.projects[0]||{},e.selectedProject=e.projects[0]||{},e.newProject=e.projects[0]||{}}).then(function(){i.loadTemplates().then(function(t){e.templates=t,e.templateNames=t.map(e=>e.name)})}).then(function(){e.currSession="RECON",e.currDuration="45",e.disableLinks=!!e.projects.length})},e.showMenu=function(t,o,r){e.resetProjectMenu(),u(),t&&(e.menu.show=!0),o&&(e.menu[o].show=!0),r&&(e.menu[o][r].show=!0)},e.openMenu=function(t){switch(t){case"project":e.loadProjectMenu(),e.showMenu("menu","project");break;case"new":e.selectedProject&&(e.selectedProject=e.projects[0]||{}),e.newProject=Object.assign({},{name:"",description:"",session:0,tasks:[],details:void 0,templateName:void 0,createdBy:e.userName,lastModifiedBy:e.userName}),e.showMenu("menu","project","new");break;case"clone":e.selectedProject&&(e.selectedProject=e.projects[0]||{}),e.newProject=Object.assign({},e.selectedProject),e.newProject.name+="(Copy)",e.showMenu("menu","project","clone");break;case"modify":e.selectedProject&&(e.selectedProject=e.projects[0]||{}),e.newProject=Object.assign({},e.selectedProject),e.showMenu("menu","project","modify");break;case"delete":e.showMenu("menu","project","delete");break;case"theme":e.showMenu("menu","theme")}},e.addProject=function(t,o){var r=(o=e.newProject).name&&o.templateName,n=!e.projects.find(e=>e.name===o.name),c=!1;if("modify"===t&&(c=o.name===e.selectedProject.name),r)if(n||c)switch(t){case"add":i.addProject(o).then(function(){j(!0,s.getResourceText("R005"),!0)});break;case"clone":i.addProject(o).then(function(){j(!0,s.getResourceText("R006"),!0)});break;case"modify":i.updateProject(o).then(function(){j(!0,s.getResourceText("R007"),!0)})}else j(!0,s.getResourceText("R002"),!1);else j(!0,s.getResourceText("R001"),!1)},e.setNewProject=function(t,o){switch(t){case"clone":e.newProject=Object.assign({},e.selectedProject),e.newProject.name+="(Copy)";break;case"modify":e.newProject=Object.assign({},e.selectedProject)}},e.delete=function(){j(!1,"",!0),e.deletebutton=!1},e.deleteProject=function(e){i.deleteProject(e).then(function(){j(!0,s.getResourceText("R008"),!0)})},e.startSession=function(t,o){i.loadProjectSession(t).then(function(t){e.selectedSession=o,e.project=new Project(t),e.project.startSession(),a.startTimer(),a.startCountDown(e.currDuration),e.timer=a.timer})},e.endSession=function(){e.project&&e.project.open&&(i.saveProjectSession(e.project.model),e.project.endSession())},e.applyTheme=function(t){var o=document.getElementById("ist");o&&(o.className=t),e.project&&e.project.views.applyTheme()},e.logout=function(){r.remove("UserName");e.endSession(),$(".modal-backdrop").remove(),o.go(appConst.states.login)},s.loadResources(),e.newProject={},u(),a.wireUpEventHandlers(),e.userName=r.getObject("UserName"),e.loadProjectMenu(),c(m,5e3)}]);