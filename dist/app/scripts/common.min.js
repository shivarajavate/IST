!function(t){"use strict";var e=function(e,i,s){this.$element=t(e),this.$items=void 0,this.options=t.extend(!0,{},t.fn.suggest.defaults,s,this.$element.data(),this.$element.data("options")),this.key=i,this.isShown=!1,this.query="",this._queryPos=[],this._keyPos=-1,this.$dropdown=t("<div />",{class:"dropdown suggest "+this.options.dropdownClass,html:t("<ul />",{class:"dropdown-menu",role:"menu"}),"data-key":this.key}),this.load()};e.prototype={__setListener:function(){return this.$element.on("suggest.show",t.proxy(this.options.onshow,this)).on("suggest.select",t.proxy(this.options.onselect,this)).on("suggest.lookup",t.proxy(this.options.onlookup,this)).on("keyup",t.proxy(this.__keyup,this)),this},__getCaretPos:function(e){var i=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"],s=!(null==window.mozInnerScreenX);return function(e,n,o){var r=document.createElement("div");r.id="input-textarea-caret-position-mirror-div",document.body.appendChild(r);var a=r.style,h=window.getComputedStyle?getComputedStyle(e):e.currentStyle;a.whiteSpace="pre-wrap","INPUT"!==e.nodeName&&(a.wordWrap="break-word"),a.position="absolute",a.visibility="hidden",t.each(i,function(t,e){a[e]=h[e]}),s?(a.width=parseInt(h.width)-2+"px",e.scrollHeight>parseInt(h.height)&&(a.overflowY="scroll")):a.overflow="hidden",r.textContent=e.value.substring(0,n),"INPUT"===e.nodeName&&(r.textContent=r.textContent.replace(/\s/g,"Â "));var l=document.createElement("span");l.textContent=e.value.substring(n)||".",r.appendChild(l);var d={top:l.offsetTop+parseInt(h.borderTopWidth),left:l.offsetLeft+parseInt(h.borderLeftWidth)};return document.body.removeChild(r),d}(this.$element.get(0),e)},__keyup:function(e){switch(e.keyCode){case 27:return void this.hide();case 13:return!0}if(-1!==t.inArray(e.keyCode,[38,40,37,39,17,18,9,16,20,91,93,36,35,45,33,34,144,112,113,114,115,116,117,118,119,120,121,122,123,145,19]))return!0;for(var i=this.$element,s=i.val(),n=this.__getSelection(i.get(0)).start,o=n;o>=0;o--){var r=s.substring(o-1,o);if(!r){this.hide();break}if(r===this.key&&""==t.trim(s.substring(o-2,o-1))){this.query=s.substring(o,n),this._queryPos=[o,n],this._keyPos=o,this.lookup(this.query);break}}},__getVisibleItems:function(){return this.$items?this.$items.not(".hidden"):t()},__build:function(){var e=this.$dropdown,i=this,s=function(t){i.hide()};e.on("click","li:has(a)",function(e){e.preventDefault(),i.__select(t(this).index()),i.$element.focus()}).on("mouseover","li:has(a)",function(t){i.$element.off("blur",s)}).on("mouseout","li:has(a)",function(t){i.$element.on("blur",s)}),this.$element.before(e).on("blur",s).on("keydown",function(e){var s;if(i.isShown)switch(e.keyCode){case 13:return(s=i.__getVisibleItems()).each(function(e){t(this).is(".active")&&i.__select(t(this).index())}),!1;case 40:return!(s=i.__getVisibleItems()).last().is(".active")&&(s.each(function(e){var i=t(this),n=s.eq(e+1);if(i.is(".active"))return n.is(".hidden")||(i.removeClass("active"),n.addClass("active")),!1}),!1);case 38:return!(s=i.__getVisibleItems()).first().is(".active")&&(s.each(function(e){var i=t(this),n=s.eq(e-1);if(i.is(".active"))return n.is(".hidden")||(i.removeClass("active"),n.addClass("active")),!1}),!1)}})},__mapItem:function(e){var i={text:"",value:""};return!(this.options.map&&!(e=this.options.map(e)))&&(e instanceof Object?(i.text=e.text||"",i.value=e.value||""):(i.text=e,i.value=e),t("<li />",{class:"dropdown-item","data-value":i.value}).html(t("<a />",{href:"#",html:i.text})))},__select:function(e){var i=this.$element,s=i.get(0),n=i.val(),o=this.get(e),r=this._keyPos+o.value.length+1;if(i.val(n.slice(0,this._keyPos)+o.value+" "+n.slice(this.__getSelection(s).start)),s.setSelectionRange)s.setSelectionRange(r,r);else if(s.createTextRange){var a=s.createTextRange();a.collapse(!0),a.moveEnd("character",r),a.moveStart("character",r),a.select()}i.trigger(t.extend({type:"suggest.select"},this),o),this.hide()},__getSelection:function(t){var e,i,s,n,o,r,a=0,h=0;return t.focus(),"number"==typeof t.selectionStart&&"number"==typeof t.selectionEnd?(a=t.selectionStart,h=t.selectionEnd):(s=document.selection.createRange())&&s.parentElement()===t&&(o=(e=t.value).length,i=e.replace(/\r\n/g,"\n"),(n=t.createTextRange()).moveToBookmark(s.getBookmark()),(r=t.createTextRange()).collapse(!1),n.compareEndPoints("StartToEnd",r)>-1?a=h=o:(a=-n.moveStart("character",-o),a+=i.slice(0,a).split("\n").length-1,n.compareEndPoints("EndToEnd",r)>-1?h=o:(h=-n.moveEnd("character",-o),h+=i.slice(0,h).split("\n").length-1)),a-=e.substring(0,a).split("\r\n").length-1,h-=e.substring(0,h).split("\r\n").length-1),{start:a,end:h}},__buildItems:function(t){var e=this.$dropdown.find(".dropdown-menu");if(e.empty(),t&&t instanceof Array)for(var i in t){var s=this.__mapItem(t[i]);s&&e.append(s)}return e.find("li:has(a)")},__lookup:function(e,i){this.$element.trigger(t.extend({type:"suggest.lookup"},this),[e,i]);i.eq(0).addClass("active");i&&i.length?this.show():this.hide()},__filterData:function(e,i){var s=this.options;return this.$items.addClass("hidden"),this.$items.filter(function(i){if(""===e)return!0;var n=t(this).find("a:first").text();return s.filter.casesensitive||(n=n.toLowerCase(),e=e.toLowerCase()),0==n.indexOf(e)}).removeClass("hidden active"),this.__getVisibleItems()},get:function(t){if(this.$items){var e=this.$items.eq(t);return{text:e.children("a:first").text(),value:e.attr("data-value"),index:t,$element:e}}},lookup:function(t){this.options;var e,i=this,s=function(e){-1!==i._keyPos&&(i.$items||(i.$items=i.__buildItems(e)),i.__lookup(t,i.__filterData(t,e)))};"function"==typeof this.options.data?(this.$items=void 0,e=this.options.data(t,s)):e=this.options.data,e&&"function"==typeof e.promise?e.done(s):e&&s.call(this,e)},load:function(){this.__setListener(),this.__build()},hide:function(){this.$dropdown.removeClass("open"),this.isShown=!1,this.$items&&this.$items.removeClass("active"),this._keyPos=-1},show:function(){var e,i=this.$element,s=this.$dropdown.find(".dropdown-menu"),n=i.get(0),o=this.options,r={top:"auto",bottom:"auto",left:"auto",right:"auto"};if(!this.isShown){if(this.$dropdown.addClass("open"),!1!==o.position){if(e=this.__getCaretPos(this._keyPos),"string"==typeof o.position)switch(o.position){case"bottom":r.top=i.outerHeight()-parseFloat(s.css("margin-top")),r.left=0,r.right=0;break;case"top":r.top=-(s.outerHeight(!0)+parseFloat(s.css("margin-top"))),r.left=0,r.right=0;break;case"caret":r.top=e.top-n.scrollTop,r.left=e.left-n.scrollLeft}else r=t.extend(r,"function"==typeof o.position?o.position(n,e):o.position);s.css(r)}this.isShown=!0,i.trigger(t.extend({type:"suggest.show"},this))}}};var i=t.fn.suggest;t.fn.suggest=function(i){var s=arguments[1],n=arguments[2],o=function(i,s){var n={};return t.each(s,function(t,s){var o=t.toString().charAt(0);n[o]=new e(i,o,"object"==typeof s&&s)}),n};return this.each(function(){var e=t(this),r=e.data("suggest"),a={};if("string"==typeof i)if(1==i.length){if(s)if("string"==typeof s){if(i in r&&void 0!==r[i][s])return r[i][s].call(r[i],n);console.error(i+" is not a suggest")}else a[i]=t.isArray(s)||"function"==typeof s?{data:s}:s,r&&i in r?r[i].options=t.extend({},r[i].options,a[i]):r=t.extend(r,o(this,a)),e.data("suggest",r)}else console.error("you're not initializing suggest properly. arg1 should have length == 1");else r?r&&(t.each(i,function(e,i){e in r==!1?a[e]=i:r[e].options=t.extend({},r[e].options,i)}),e.data("suggest",t.extend(r,o(this,a)))):e.data("suggest",o(this,i))})},t.fn.suggest.defaults={data:[],map:void 0,filter:{casesensitive:!1},dropdownClass:"",position:"caret",onshow:function(t){},onselect:function(t,e){},onlookup:function(t,e){}},t.fn.suggest.Constructor=e,t.fn.suggest.noConflict=function(){return t.fn.suggest=i,this}}(jQuery);