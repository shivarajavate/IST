class Project{constructor(e={model:{},template:{},uiSettings:{views:[]}}){var t=this;t.model=new ProjectDataModel(e.model),t.template=new ProjectTemplateModel(e.template);var o=[];e.uiSettings.views.forEach(function(e){e.params={data:{model:t.model,template:t.template},callbacks:{add:t.addNodeAction.bind(t),update:t.updateNodeAction.bind(t),delete:t.deleteNodeAction.bind(t),close:t.unselectNodeAction.bind(t)}},o.push(e)}),t.views=new ProjectViewModel(o),t.noteForm,t.undoManager=new UndoManager,t.open=!1,t.views.applyTheme()}startSession(){var e=this;e.views.workspace.forEach(function(t){t.view.set(e.model.details.levels)}),e.views.mindMap.view.set(e.model.details.levels),e.undoManager.clear(),e.model.upgradeSession(),e.open=!0}endSession(){this.open=!1}openNoteForm(e){var t={add:this.addNoteAction.bind(this),delete:this.deleteNoteAction.bind(this),update:this.updateNoteAction.bind(this),submit:e.noteExists?this.updateNoteAction.bind(this):this.addNoteAction.bind(this),close:this.unselectNoteAction.bind(this)};e.note=e.noteExists?e.note:this.model.newNote({name:"new",secName:e.secName,levelName:e.levelName},this.template),e.template=this.template.noteTemplate(e.secName,e.levelName,e.wsName),e.tags=this.model.suggestTags(e.wsName),this.noteForm=new NoteForm,this.noteForm.init(e,t)}addDataModel(e={note:{},node:{}},t=-1,o=!1){this.model.addNote(e.note,t)&&(this.views.workspace.forEach(function(o){t=o.view.add(e.note,t)}),this.views.mindMap.view.add(e.node),o&&this.undoManager.add({undo:this.deleteDataModel.bind(this,e,!1),redo:this.addDataModel.bind(this,e,t,!1)}))}updateDataModel(e={note:{},node:{}},t={note:{},node:{}},o=!1){this.model.updateNote(t.note)&&(this.views.workspace.forEach(function(e){e.view.update(t.note)}),this.views.mindMap.view.update(e.node,t.node),o&&this.undoManager.add({undo:this.updateDataModel.bind(this,t,e,!1),redo:this.updateDataModel.bind(this,e,t,!1)}))}deleteDataModel(e={note:{},node:{}},t=!1){this.model.deleteNote(e.note)&&(this.views.workspace.forEach(function(t){t.view.delete(e.note)}),this.views.mindMap.view.delete(e.node),t&&this.undoManager.add({undo:this.addDataModel.bind(this,e,-1,!1),redo:this.deleteDataModel.bind(this,e,!1)}))}addNoteAction(e,t=-1,o=!0){var a=this.model.viewDataModelFromNote(e,this.template);this.addDataModel(a,t,o)}updateNoteAction(e,t,o=!0){var a=this.model.viewDataModelFromNote(e,this.template),i=this.model.viewDataModelFromNote(t,this.template);this.updateDataModel(a,i,o)}deleteNoteAction(e,t=!0){var o=this.model.viewDataModelFromNote(e,this.template);this.deleteDataModel(o,t)}unselectNoteAction(){this.views.workspace.forEach(function(e){e.view.unselect()})}addNodeAction(e,t=-1,o=!0){var a=this.model.viewDataModelFromNode(e,this.template);this.addDataModel(a,t,o)}updateNodeAction(e,t,o=!0){var a=this.model.viewDataModelFromNode(e,this.template),i=this.model.viewDataModelFromNode(t,this.template);this.updateDataModel(a,i,o)}deleteNodeAction(e,t=!0){var o=this.model.viewDataModelFromNode(e,this.template);this.deleteDataModel(o,t)}unselectNodeAction(){this.views.mindMap.view.unselect()}download(){var e=this.name+(new Date).toLocaleString(),t="data:text/html;charset=utf-8,"+encodeURIComponent(this.getData("text/html")),o=document.createElement("a");o.download=e,o.href=t,o.onclick=function(e){document.body.removeChild(e.target)},o.style.display="none",document.body.appendChild(o),o.click()}getData(e){var t="";switch(e){case"text/plain":t+=this.name+"\r\n",t+="Created on: ",t+=(new Date).toLocaleString()+"\r\n",this.views.workspace.forEach(function(o){t+=o.view.getData(e)}),t+="NOTES:\r\n",this.model.details.notes.forEach(function(e,o){t+=o+1+". "+e+"\r\n"}),t+="QUESTIONS:\r\n",this.model.details.questions.forEach(function(e,o){t+=o+1+". "+e+"\r\n"});break;case"text/html":t+="<head>",t+="<style>",t+=".contents {",t+="display: inline-block;",t+="padding: 7px;",t+="line-height: 1.6;",t+="border: 1px solid #a2a9b1;",t+="background-color: #f8f9fa;",t+="font-size: 95%;",t+="margin-bottom: 5px;",t+="padding: 5px;",t+="}",t+="a {",t+="text-decoration:none;",t+="}",t+=".content-heading ,.workspace-container {",t+="background-color : #f8f9fa;",t+="text-align: center;",t+="}",t+="li {",t+="list-style-type: none;",t+="}",t+="</style>",t+="</head>",t+="<h3>",t+=this.name,t+="</h3>",t+="<h4>",t+="Downloaded on: ",t+=(new Date).toLocaleString(),t+="</h4>",t+='<div class = "contents">',t+='<div class = "content-heading">Contents</div>',t+="<table>",t+="<tr>",this.views.workspace.forEach(function(e){t+=e.view.getTitle()}),t+="</tr>",t+="</table>",t+="</div>",this.views.workspace.forEach(function(o){t+=o.view.getData(e)}),t+="<hr>",t+="NOTES:<br>",0==this.model.details.notes.length&&(t+="(empty)",t+="<br>"),this.model.details.notes.forEach(function(e,o){t+=o+1+". "+e+"<br>"}),t+="<br>QUESTIONS:<br>",0==this.model.details.questions.length&&(t+="(empty)",t+="<br>"),this.model.details.questions.forEach(function(e,o){t+=o+1+". "+e+"<br>"})}return t}}