class Project{constructor(e={model:{},template:{},uiSettings:{views:[]}}){var t=this;t.model=new ProjectDataModel(e.model),t.template=new ProjectTemplateModel(e.template),t.uiSettings=new ProjectUisettingModel(e.uiSettings),t.views=new ProjectView,e.uiSettings.views.forEach(function(e,a){switch(e.name){case"reconWorkspace":var o={data:{viewParams:e,template:t.template,uiSettings:t.uiSettings.views[a]},callbacks:{}};t.views.addReconWorkspaceView(o);break;case"searchWorkspace":o={data:{viewParams:e,template:t.template,uiSettings:t.uiSettings.views[a]},callbacks:{}};t.views.addSearchWorkspaceView(o);break;case"mindMap":var i=t.model.defaultMindMapData(t.template);o={data:{viewParams:e,nodes:i.nodes,edges:i.edges,uiSettings:t.uiSettings.views[a]},callbacks:{add:t.addNodeAction.bind(t),update:t.updateNodeAction.bind(t),delete:t.deleteNodeAction.bind(t),close:t.unselectNodeAction.bind(t)}};t.views.addMindMapView(o)}}),t.noteForm,t.undoManager=new UndoManager,t.open=!1,t.applyTheme()}startSession(){var e=this;e.views.workspace.forEach(function(t){t.set(e.model.details.levels)}),e.views.mindMap.set(e.model.details.levels),e.undoManager.clear(),e.open=!0}abortSession(){this.open=!1}openNoteForm(e){var t={add:this.addNoteAction.bind(this),delete:this.deleteNoteAction.bind(this),update:this.updateNoteAction.bind(this),submit:e.noteExists?this.updateNoteAction.bind(this):this.addNoteAction.bind(this),close:this.unselectNoteAction.bind(this)};e.note=e.noteExists?e.note:this.model.newNote({name:"new",secName:e.secName,levelName:e.levelName},this.template),e.template=this.template.noteTemplate(e.secName,e.levelName,e.wsName),e.tags=this.model.suggestTags(e.wsName),this.noteForm=new NoteForm,this.noteForm.init(e,t)}addDataModel(e={note:{},node:{}},t=-1,a=!1){this.model.addNote(e.note,t)&&(this.views.workspace.forEach(function(a){t=a.add(e.note,t)}),this.views.mindMap.add(e.node),a&&this.undoManager.add({undo:this.deleteDataModel.bind(this,e,!1),redo:this.addDataModel.bind(this,e,t,!1)}))}updateDataModel(e={note:{},node:{}},t={note:{},node:{}},a=!1){this.model.updateNote(t.note)&&(this.views.workspace.forEach(function(e){e.update(t.note)}),this.views.mindMap.update(e.node,t.node),a&&this.undoManager.add({undo:this.updateDataModel.bind(this,t,e,!1),redo:this.updateDataModel.bind(this,e,t,!1)}))}deleteDataModel(e={note:{},node:{}},t=!1){this.model.deleteNote(e.note)&&(this.views.workspace.forEach(function(t){t.delete(e.note)}),this.views.mindMap.delete(e.node),t&&this.undoManager.add({undo:this.addDataModel.bind(this,e,position,!1),redo:this.deleteDataModel.bind(this,e,!1)}))}addNoteAction(e,t=-1,a=!0){var o=this.model.viewDataModelFromNote(e,this.template);this.addDataModel(o,t,a)}updateNoteAction(e,t,a=!0){var o=this.model.viewDataModelFromNote(e,this.template),i=this.model.viewDataModelFromNote(t,this.template);this.updateDataModel(o,i,a)}deleteNoteAction(e,t=!0){var a=this.model.viewDataModelFromNote(e,this.template);this.deleteDataModel(a,t)}unselectNoteAction(){this.views.workspace.forEach(function(e){e.unselect()})}addNodeAction(e,t=-1,a=!0){var o=this.model.viewDataModelFromNode(e,this.template);this.addDataModel(o,t,a)}updateNodeAction(e,t,a=!0){var o=this.model.viewDataModelFromNode(e,this.template),i=this.model.viewDataModelFromNode(t,this.template);this.updateDataModel(o,i,a)}deleteNodeAction(e,t=!0){var a=this.model.viewDataModelFromNode(e,this.template);this.deleteDataModel(a,t)}unselectNodeAction(){this.views.mindMap.unselect()}applyTheme(){var e=this;e.uiSettings.update(),e.views.workspace.forEach(function(t,a){t.applyTheme(e.uiSettings.views[a].styles)}),e.views.mindMap.applyTheme(e.uiSettings.views[2].options)}download(){var e=this.name+(new Date).toLocaleString(),t="data:text/html;charset=utf-8,"+encodeURIComponent(this.getData("text/html")),a=document.createElement("a");a.download=e,a.href=t,a.onclick=function(e){document.body.removeChild(e.target)},a.style.display="none",document.body.appendChild(a),a.click()}getData(e){var t="";switch(e){case"text/plain":t+=this.name+"\r\n",t+="Created on: ",t+=(new Date).toLocaleString()+"\r\n",this.views.workspace.forEach(function(a){t+=a.getData(e)}),t+="NOTES:\r\n",this.model.details.notes.forEach(function(e,a){t+=a+1+". "+e+"\r\n"}),t+="QUESTIONS:\r\n",this.model.details.questions.forEach(function(e,a){t+=a+1+". "+e+"\r\n"});break;case"text/html":t+="<head>",t+="<style>",t+=".contents {",t+="display: inline-block;",t+="padding: 7px;",t+="line-height: 1.6;",t+="border: 1px solid #a2a9b1;",t+="background-color: #f8f9fa;",t+="font-size: 95%;",t+="margin-bottom: 5px;",t+="padding: 5px;",t+="}",t+="a {",t+="text-decoration:none;",t+="}",t+=".content-heading ,.workspace-container {",t+="background-color : #f8f9fa;",t+="text-align: center;",t+="}",t+="li {",t+="list-style-type: none;",t+="}",t+="</style>",t+="</head>",t+="<h3>",t+=this.name,t+="</h3>",t+="<h4>",t+="Downloaded on: ",t+=(new Date).toLocaleString(),t+="</h4>",t+='<div class = "contents">',t+='<div class = "content-heading">Contents</div>',t+="<table>",t+="<tr>",this.views.workspace.forEach(function(e){t+=e.getTitle()}),t+="</tr>",t+="</table>",t+="</div>",this.views.workspace.forEach(function(a){t+=a.getData(e)}),t+="<hr>",t+="NOTES:<br>",0==this.model.details.notes.length&&(t+="(empty)",t+="<br>"),this.model.details.notes.forEach(function(e,a){t+=a+1+". "+e+"<br>"}),t+="<br>QUESTIONS:<br>",0==this.model.details.questions.length&&(t+="(empty)",t+="<br>"),this.model.details.questions.forEach(function(e,a){t+=a+1+". "+e+"<br>"})}return t}}