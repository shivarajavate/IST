class Project{constructor(e={model:{},views:[],template:{},uiSettings:{}}){var t=this;t.model=new ProjectDataModel(e.model),t.template=new ProjectTemplateModel(e.template),t.uiSettings=new ProjectUisettingModel(e.uiSettings),t.views=new ProjectView,e.views.forEach(function(e){switch(e.name){case"reconWorkspace":var i={data:{viewParams:e,template:t.template,uiSettings:t.uiSettings},callbacks:{}};t.views.addReconWorkspaceView(i);break;case"searchWorkspace":i={data:{viewParams:e,template:t.template,uiSettings:t.uiSettings},callbacks:{}};t.views.addSearchWorkspaceView(i);break;case"mindMap":var s=t.model.defaultMindMapData(t.template);i={data:{viewParams:e,nodes:s.nodes,edges:s.edges,options:t.uiSettings.mindMapProperties},callbacks:{add:t.addNodeAction.bind(t),update:t.updateNodeAction.bind(t),delete:t.deleteNodeAction.bind(t),close:t.unselectNodeAction.bind(t)}};t.views.addMindMapView(i)}}),t.noteForm,t.selectedWorkspaceIndex=-1,t.undoManager=new UndoManager,t.open=!0,t.applyTheme()}startSession(e){this.selectedWorkspaceIndex=this.views.workspace.findIndex(t=>t.name===e),this.views.workspace[this.selectedWorkspaceIndex].set(this.model.details.levels),this.views.mindMap.set(this.model.details.levels),this.undoManager.clear(),this.applyTheme()}abortSession(){this.selectedWorkspaceIndex=-1}openNoteForm(e){var t={add:this.addNoteAction.bind(this),delete:this.deleteNoteAction.bind(this),update:this.updateNoteAction.bind(this),submit:e.noteExists?this.updateNoteAction.bind(this):this.addNoteAction.bind(this),close:this.unselectNoteAction.bind(this)};e.note=e.noteExists?e.note:this.model.newNote({name:"new",secName:e.secName,levelName:e.levelName},this.template),e.template=this.template.noteTemplate(e.secName,e.levelName,e.wsName),e.tags=this.model.suggestTags(e.wsName),this.noteForm=new NoteForm,this.noteForm.init(e,t)}addNoteAction(e,t=-1,i=!0){var s=this.model.createNodeFromNote(e);t=this.views.workspace[this.selectedWorkspaceIndex].add(e,t),this.views.mindMap.add(s),i&&this.undoManager.add({undo:this.deleteNoteAction.bind(this,e,!1),redo:this.addNoteAction.bind(this,e,t,!1)})}updateNoteAction(e,t,i=!0){var s=this.model.createNodeFromNote(e);this.views.mindMap.update(s,t.name);this.views.workspace[this.selectedWorkspaceIndex].update(t),i&&this.undoManager.add({undo:this.updateNoteAction.bind(this,t,e,!1),redo:this.updateNoteAction.bind(this,e,t,!1)})}deleteNoteAction(e,t=!0){var i=this.model.createNodeFromNote(e),s=this.views.workspace[this.selectedWorkspaceIndex].delete(e);this.views.mindMap.delete(i),t&&this.undoManager.add({undo:this.addNoteAction.bind(this,e,s,!1),redo:this.deleteNoteAction.bind(this,e,!1)})}unselectNoteAction(){this.views.workspace[this.selectedWorkspaceIndex].unselect()}addNodeAction(e,t=-1,i=!0){var s=this.model.createNoteFromNode(e,this.template);this.views.mindMap.add(e),e.isNote&&(t=this.views.workspace[this.selectedWorkspaceIndex].add(s,t)),i&&this.undoManager.add({undo:this.deleteNodeAction.bind(this,e,!1),redo:this.addNodeAction.bind(this,e,t,!1)})}updateNodeAction(e,t,i=!0){this.model.createNoteFromNode(e,this.template);var s=Object.assign({},e),a=this.views.mindMap.update(e,t),o=this.model.createNoteFromNode(a,this.template);this.views.workspace[this.selectedWorkspaceIndex].update(o),i&&this.undoManager.add({undo:this.updateNodeAction.bind(this,a,s.name,!1),redo:this.updateNodeAction.bind(this,s,t,!1)})}deleteNodeAction(e,t=!0){var i=this.model.createNoteFromNode(e,this.template);if(this.views.mindMap.delete(e),e.isNote)var s=this.views.workspace[this.selectedWorkspaceIndex].delete(i);t&&this.undoManager.add({undo:this.addNodeAction.bind(this,e,s,!1),redo:this.deleteNodeAction.bind(this,e,!1)})}unselectNodeAction(){this.views.mindMap.unselect()}applyTheme(){var e=this;e.uiSettings.update(),e.views.workspace.forEach(function(t){t.applyTheme(e.uiSettings.styles)}),e.views.mindMap.applyTheme(e.uiSettings.mindMapStyles)}download(){var e=this.name+(new Date).toLocaleString(),t="data:text/html;charset=utf-8,"+encodeURIComponent(this.getData("text/html")),i=document.createElement("a");i.download=e,i.href=t,i.onclick=function(e){document.body.removeChild(e.target)},i.style.display="none",document.body.appendChild(i),i.click()}getData(e){var t="";switch(e){case"text/plain":t+=this.name+"\r\n",t+="Created on: ",t+=(new Date).toLocaleString()+"\r\n",this.views.workspace.forEach(function(i){t+=i.getData(e)}),t+="NOTES:\r\n",this.model.details.notes.forEach(function(e,i){t+=i+1+". "+e+"\r\n"}),t+="QUESTIONS:\r\n",this.model.details.questions.forEach(function(e,i){t+=i+1+". "+e+"\r\n"});break;case"text/html":t+="<head>",t+="<style>",t+=".contents {",t+="display: inline-block;",t+="padding: 7px;",t+="line-height: 1.6;",t+="border: 1px solid #a2a9b1;",t+="background-color: #f8f9fa;",t+="font-size: 95%;",t+="margin-bottom: 5px;",t+="padding: 5px;",t+="}",t+="a {",t+="text-decoration:none;",t+="}",t+=".content-heading ,.workspace-container {",t+="background-color : #f8f9fa;",t+="text-align: center;",t+="}",t+="li {",t+="list-style-type: none;",t+="}",t+="</style>",t+="</head>",t+="<h3>",t+=this.name,t+="</h3>",t+="<h4>",t+="Downloaded on: ",t+=(new Date).toLocaleString(),t+="</h4>",t+='<div class = "contents">',t+='<div class = "content-heading">Contents</div>',t+="<table>",t+="<tr>",this.views.workspace.forEach(function(e){t+=e.getTitle()}),t+="</tr>",t+="</table>",t+="</div>",this.views.workspace.forEach(function(i){t+=i.getData(e)}),t+="<hr>",t+="NOTES:<br>",0==this.model.details.notes.length&&(t+="(empty)",t+="<br>"),this.model.details.notes.forEach(function(e,i){t+=i+1+". "+e+"<br>"}),t+="<br>QUESTIONS:<br>",0==this.model.details.questions.length&&(t+="(empty)",t+="<br>"),this.model.details.questions.forEach(function(e,i){t+=i+1+". "+e+"<br>"})}return t}}